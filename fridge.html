<!DOCTYPE html>

<!--
    Brendan Gibbons
    CMPT 330 111
    Professor Tokash

    April 9, 2023

    BG The Fridge App

-->

<html lang="en-us">

<head>
    <meta charset="utf-8">
    <title>Welcome to The Fridge!</title>

    <style>
        :root {
            
            color: black;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
                Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        header {
            width: 100%;
            height: 15dvh;
        }

        #footerBar {
            position: fixed;

            width: 100%;
            height: 5dvh;
            bottom: 0;
            left: 0;

            background-color: #0a0a0a;
            color: #fefefe;

            display: flex;
            flex-direction: column;

            vertical-align: middle;
        }

                /* Footer Contents */


        #footerText {
            text-align: left;
        }

        #credits {
            text-align: right;
        }



        #controlBar > button {
            height: 100%;

            vertical-align: middle;

            height: 100%;
            font-size: clamp(.05rem, 1.25dvh, 2.75rem);
        }

        #screen {
            height: 100%;
            width: 100%;

            background-color: #1e1e1e;
            color: #fefefe;

            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }
        
        #screenContents {
            display: flex;
            flex-direction: row;
            
            position: relative;
            top: 2%;
            left: 0%;

            height: 90%;
   
        }

        .leftGrid {
            float: left;
            
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            vertical-align: middle;


            width: 45%;
            height: 95%;

            margin-left: 1%;
        }

        .rightGrid {
            float: right;

            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            vertical-align: middle;

            width: 45%;
            height: 95%;
            margin-right: 1%;
        }

        .clearBreak {
            height: 0px;
            clear: both;
        }


        /* Class-defined CSS Styles */

        #titleBar {
            text-align: center;
            border-bottom: 3px solid #fefefe;
        }

        #titleBar > h1 {
            letter-spacing: 2px;
            
        }

        #titleBar > span {
            letter-spacing: 4px;
        }

        /* Navigation and Controls */

        button {
            background-color: #2e2e2e;
            border: 2px solid #000000;
            border-radius: 4px;
            color: #fefefe;
            height: calc(inherit - .25%);
            padding: 4px;

            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
                Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        button:hover {
            background-color: #505050;
            cursor: pointer;

            transition: all .2s ease-in-out;
        }

        button:active {
            background-color:#686868;
            border-color: #1e1e1e;
            inset: 4px;

            transition: all .1s linear;
        }

        #controls {
            vertical-align: middle;
        }

        /* Weather and Time Information */

        #tempBox {
            font-weight: bold;

            font-size: large;
            float: right;
        }

        #temperatureBoxText {
            text-align: right;
        } 

        #informationBar {
            width: 100%;
            height: 3.5%;

            display: flex;
            flex-direction: row;
            justify-content: flex-end;
            align-items: center;

            padding: .5% 0% .5% 0%;
        }

        #timeText {
            padding-inline-start: 1%;
        }

        #weatherConditions {
            height: 100%;
        }

        #fridgeDisplayUnit {
            width: 100%;
        }

        /* Fridge Layout - Left Side*/

        #fridgeImage {
            opacity: 0;
            max-width: 100%;
            max-height: inherit;
        }


        /* Television Set */

        #tv\.app {
            width: 100%;
            height: 100%;
        }
        
        #televisionImage {
            text-align: center;
            width: 100%;
            height: 98%;
            border: none;

            overflow: hidden;
            
        }

        /* Web Browser (Which really just acts as a search box for Google) */

        #browser {
            background-color: inherit;
            color: inherit;
            
            position: relative;
            top: 30%;


            width: 100%;

            text-align: center;
            vertical-align: middle;
        }

        #googleLogo {
            shape-rendering: crispEdges;
            width: 30%;

            text-align: center;
        }


        #searchBarInput {
            background-color: #2e2e2e;
            border: 2px solid #000000;
            border-radius: 4px;
            color: #fefefe;
            height: 3.5%;
            padding: 4px;

            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
                Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;

            width: 75%;
        }

        #searchBarInput:hover {
            background-color: #505050;
            cursor: text;

            transition: all .2s ease-in-out;
        }

        #searchBarInput:active {
            background-color:#686868;
            border-color: #1e1e1e;
            inset: 4px;

            transition: all .1s linear;
        }

        #searchButtonButton {
            width: 5%;
        }
        

        /* Main Menu */

        #calendar {
            background-color:#ffffff;
            border-radius: 5%;
            border-color: #1e1e1e;

            color: #0a0a0a;

            inset: 4px;

            transition: all .1s linear;
        }

        #calendar > table {
            width: 100%;
            height: 75%;
            text-align: center;
            border-width: 2%;
        }

        #calendar .today {
            background-color: lightskyblue;
            border-radius: 100%;
        }

        #calendarBottomDivider {
            border-top: .25% solid #1e1e1e;

            width: 98%
        }
        
        #controlBar {
            position:relative;
            bottom: 0;

            width: 100%;
            height: 7%;

            background-color: #000000;

            font-size: clamp(.1rem, 1.5dvh, 3rem);

        }

        .hidden {
            opacity: 0%;
            display: none;
        }

        .collapsed {
            height: 0px;
            display: none;
        }

        .grid {
            border: 1px solid limegreen;
        }

        .appBlock {
            width: 1/3;
            
            border-radius: 5%;
            
            width: 2%;
            height: 2%;

            text-align: center;
        }

        .appBlock:hover {
            background-color: #505050;
            cursor: pointer;

            transition: all .2s ease-in-out;
        }

        .appBlock:active {
            background-color:#686868;
            border-color: #1e1e1e;
            inset: 4px;

            transition: all .05s linear;
        }

        .appIcon {
            width: calc((1/3) * 100%);
        }

        #menu {
            vertical-align: middle;
        }

        #menuAppIcons {
            width: 100%;
            height: 100%;
        }

        .circularControlButton {
            border-radius: 100%;
            padding: 0% .4% 0% .4%;
        }

        #dateAndEvents {
            display: flex;
            flex-direction: row;

            padding-left: 5%;
            width: 100%;
            height: 20%;

            font-size: clamp(1rem, 2.25vw, 3.5rem);
        }

        #date {
            background-color:#fefefe;
            border: 2px solid #1e1e1e;
            border-top: clamp(.1rem, 1vw, 1.75rem) ridge red;
            border-radius: 10%;
            
            width: 15%;
            height: 65%;

            text-align: center;
            vertical-align: middle;

            font-size: clamp(1rem, 3.5vw, 4rem);
            font-weight: bold;
        }

        #eventText {
            padding-left: 5%;
        }

        #web\.app {
            width: 100%;
        }

        #browserTabs {
            display: flex;
            flex-direction: row;
            
            background-color: #686868;
            
            height: 8%;
            width: 100%;

            vertical-align:middle;

        }

        .browserNavButton {
            padding: .5%;
            height: 80%;
        }

        #browserUrlBar {
            border-radius: 5%;
            background-color: #adadad;
            color: #ffffff;

            width: 75dvw;
            
            display: flex;
            flex-direction: row;

            vertical-align: middle;
        }

        #browserUrlBarInput {
            border: none;
            background-color: inherit;
            color: inherit;

            width: 90%;

        }

        #spotify\.app {
            width: 100%;
            height: 100%;
        }

        #spotifyInterface {
            width: 100%;
            height: 100%;

            display: flex;
            flex-direction: column;

            text-align: center;
            align-content: center;
        }


        #albumInformation {    
            width: 100%;
            height: 80%;

            display: flex;
            flex-direction: column;

            text-align: center;
            align-items: center;
        }

        #spotifySongTitle {
            padding: 3%;
        }

        #spotifyCoverArt {
            width: 15%;
            border-radius: 10%;
        }

        #spotifyControls {
            width: 100%;
            height: 10%;
        }

        .mediaControl {
            background-color: #e6e6e6;
            border-radius: 100%;
            image-rendering: crisp-edges;

            margin: .5%;

            max-height: 100%;

        }

        #tasks\.app {
            width: 100%;
            height: 100%;
        }

        #taskListCollectionContainer {
            width: 100%;
            height: 65%;
        }

        #taskListCollection {
            width: 100%;
            height: 100%;
        }

        #taskAddItemButton {
            width: 10%;
            height: 10%;

            display: none;

            background-image: url("img/system/add_white.png");
            background-size: cover;
            background-position: center;
        }

        .selectionListBlock {
            display: flex;
            flex-direction: row;

            background-color: #2e2e2e;
            padding: .5%;
            width: 100%;
        }

        .selectionListBlock:hover {
            background-color: #505050;
            cursor: pointer;

            transition: all .2s ease-in-out;
        }

        .selectionListBlock:active {
            background-color:#686868;
            border-color: #1e1e1e;
            inset: 4px;

            transition: all .05s linear;
        }

        .tableListContainer {
            overflow: hidden;
            /* https://stackoverflow.com/questions/12597897/how-do-i-make-a-table-scrollable*/
            overflow-y: scroll;
        }

        #currentTaskList {
            background-color:#505050;
            border-radius: 5%;
            border-color: #1e1e1e;

            color: #fefefe;

            inset: 4px;

            transition: all .1s linear;

            display: flex;
            flex-direction: column;
            vertical-align: middle;
            
        }

        #currentTaskList .selectionListBlock {
            border-radius: 3%;
        }

        #currentTaskListTableContainer {
            width: 95%;
            height: 65%;
            
            display: none;

            overflow: hidden;
            overflow-y: scroll;
        }

        #currentTaskListTable {
            width: 100%;
            height: 100%;
        }

        #currentTaskListTable >  tr {
            padding: 1%;
            border-radius: 3%;
            width: 100%;
        }


        .taskChecklistItem {
            background-color: inherit;
            color: inherit;
            font-family: inherit;
            font-size: inherit;

            border: none;

            height: 18%;
            width: 50%;
        }

        .taskChecklistItem > button {
            height: 100%;
            font-size: clamp(.25rem, 1rem, 3rem);
            padding: clamp(.05rem, .5%, 1rem);
        }

        #tasks\.app {
            width: 100%;
            height: 100%;
        }

        #timer\.app {
            width: 100%;
            height: 100%;
        }

        #currentTimer {
            display: flex;
            flex-direction: column;

            align-items: center;
            vertical-align: middle;

            background-color:#424242;
            border-radius: 5%;
            border-color: #1e1e1e;

            color: #fefefe;

            inset: 4px;

            transition: all .1s linear;
            
        }

        #timerListCollectionContainer {
            width: 100%;
            height: 65%;
        }

        #timerListCollection {
            width: 100%;
            height: 100%;
        }

        .timerClock {
            font-size: clamp(1rem, 10dvh, 8rem);
            height: 85%;
        }

        #currentTimerName {
            height: 15%;
        }

        #currentTimerInformationContainer {
            display: flex;
            flex-direction: column;

            align-items: center;
            vertical-align: middle;
            
            height: 85%;
        }


        
    </style>
</head>

<body onload="scaleDisplay(); randomizeFridgeTemperature(); loadTimerLists(); loadTaskLists(); setTimers(); " 
    onresize="scaleDisplay();">

    <header>
        <div id="titleBar">
            <span>WELCOME TO</span>
            <h1>The Fridge</h1>
        </div>
        <br>
    </header>

    <main id="fridgeDisplayUnit">

        <div id="screen">
        
            <div id="informationBar">
                <!-- Although it's best practive to fill the source, title, and alt attributes,
                     the use of APIs makes it hard to abide for this element. -->
                <img id="weatherConditions" src="" title="">
                <span id="outsideWeatherDisplay" onclick="toggleTemperatureUnits();"> 
                    <em id="weatherConditionsText"></em>
                    <span id="temperatureBoxText" title="Obtained from the NWS KPOU observation center">
                        Getting the weather...</span> &#x00b0; <span class="temperatureUnits">F</span>
                </span>
                <span id="timeText" onclick="toggle12HourTime();">0:00:00 am</span>
            </div>

            <div id="screenContents">
                <div id="home" class="activeApp">
                    <div id="calendar" class="leftGrid">
                        <table>
                            <tr>
                                <th>S</th>
                                <th>M</th>
                                <th>T</th>
                                <th>W</th>
                                <th>T</th>
                                <th>F</th>
                                <th>S</th>
                            </tr>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td>1</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>3</td>
                                <td>4</td>
                                <td class="today">5</td>
                                <td>6</td>
                                <td>7</td>
                                <td>8</td>
                            </tr>
                            <tr>
                                <td>9</td>
                                <td>10</td>
                                <td>11</td>
                                <td>12</td>
                                <td>13</td>
                                <td>14</td>
                                <td>15</td>
                            </tr>
                            <tr>
                                <td>16</td>
                                <td>17</td>
                                <td>18</td>
                                <td>19</td>
                                <td>20</td>
                                <td>21</td>
                                <td>22</td>
                            </tr>
                            <tr>
                                <td>23</td>
                                <td>24</td>
                                <td>25</td>
                                <td>26</td>
                                <td>27</td>
                                <td>28</td>
                                <td>29</td>
                            </tr>
                            <tr>
                                <td>30</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </table>

                        <hr id="calendarBottomDivider">

                        <div id="dateAndEvents">
                            <div id="date">
                                5
                            </div>
                            <span id="eventText">No events today</span>
                        </div>
                        

                    </div>
        
                    <div id="menu" class="rightGrid">
                        <table id="menuAppIcons">
                            <tr>
                                <td class="appBlock" onclick="switchApps('spotify.app');">
                                    <img src="img/Spotify_Logo_RGB_Green.png" alt="Spotify" class="appIcon"
                                        ><br>
                                    <span>Spotify</span>
                                </td>
                                <td class="appBlock">
                                    <img src="img/Sun.png" alt="Weather" class="appIcon"><br>
                                    <span>Weather</span>
                                </td>
                                <td class="appBlock" onclick="switchApps('tasks.app');">
                                    <img src="img/Tasks.png" alt="Tasks" class="appIcon"><br>
                                    <span>Tasks</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="appBlock" onclick="switchApps('web.app');">
                                    <img src="img/Internet.png" alt="Web Browser" class="appIcon"><br>
                                    <span>Web Browser</span>
                                </td>
                                <td class="appBlock" onclick="switchApps('timer.app');">
                                    <img src="img/Timer.png" alt="Timer" class="appIcon"><br>
                                    <span>Timer</span>
                                </td>
                                <td class="appBlock" onclick="switchApps('tv.app'); tvLoadPrep();">
                                    <img src="img/TV.png" alt="Television" class="appIcon"><br>
                                    <span>Television</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="appBlock">
                                    <img src="img/Settings.png" alt="Settings" class="appIcon"><br>
                                    <span>Settings</span>
                                </td>
                                <td class=""> </td>
                                <td class=""> </td>
                            </tr>
                        </table>
                    </div>
        
                    <br class="clearBreak hidden">
                </div>

                <div id="spotify.app" class="hidden">
                    <audio id="spotifyMusicSource" src="audio/freestylemix_-_hisboyelroy_-_Revolve.mp3" preload></audio>
                    <div id="spotifyInterface">
                        <div id="albumInformation">
                            <span id='spotifySongTitle'>Revolve - cinematrik</span>
                            <img id='spotifyCoverArt' src="img/spotify.app/spotify_defaultCover.png" alt="Song Cover Art">
                            <br>
                        </div>
                        <div id="spotifyControls">
                            <img id='spotifySkipToPreviousButton' src="img/mediaControl/control_Previous.png" alt="Go Back to the Previous Song"
                                class="mediaControl">
                            <img id='spotifySeekBackwardButton' src="img/mediaControl/control_skipBack.png" alt="Seek Backward 10 Seconds"
                                class="mediaControl">
                            <img id='spotifyPlayButton' src="img/mediaControl/control_Play.png" alt="Play Music" class="mediaControl"
                                onclick="spotifyPlayPause();">
                            <img id='spotifySeekForwardButton' src="img/mediaControl/control_skipForward.png" alt="Seek Forward 10 Seconds"
                                class="mediaControl">
                            <img id='spotifySkipToNextButton' src="img/mediaControl/control_Next.png" alt="Skip to the Next Song"
                                class="mediaControl">
                        </div>
                    </div>
                </div>

                <div id="tasks.app" class="hidden">
                    <div id="currentTaskList" class="leftGrid grid">
                        <h2 id="currentTaskListName">Select a List</h2>
                        <div id='currentTaskListTableContainer'>
                            <!-- https://stackoverflow.com/questions/12597897/how-do-i-make-a-table-scrollable -->
                            <table id='currentTaskListTable'>
                            
                            </table>
                        </div>
                        <button id="taskAddItemButton" onclick="addTaskItem(document.getElementById('currentTaskListName').innerText)" title="Add a Task Item"></button>
                    </div>
                    
                    <div id="taskListSet" class="rightGrid grid">
                        <h2>Task Lists </h2>
                        <div id='taskListCollectionContainer' class='tableListContainer'>
                            <table id="taskListCollection">
                            
                            </table>
                        </div>      
                    </div>
                    
                    <br class="clearBreak hidden">
                </div>

                <div id="web.app" class="hidden">
                    <div id="browserTabs">
                        <img src="img/web.app/browser_home.png" alt="Home Button" class="browserNavButton">
                        <img src="img/web.app/browser_newTab.png" alt="New Browser Tab Button" class="browserNavButton">
                        <img src="img/web.app/browser_back.png" alt="Previous Page Button" class="browserNavButton">
                        <img src="img/web.app/browser_forward.png" alt="Next Page Button" class="browserNavButton">
                        <div id='browserUrlBar'> 
                            <img src="img/web.app/browser_security_HTTPSSecure.png" alt="HTTPS Secure Connection" class="browserNavButton">
                            <input type="text" id="browserUrlBarInput" value="https://www.google.com"> 
                        </div>
                        
                        <img src="img/web.app/browser_refresh.png" alt="Refresh Button" class="browserNavButton">
                        
                    </div>
                    <div id="browser">
                        <img id="googleLogo" src="https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png"
                            alt="Google Search Logo"><br>
                        <br>
                        <input id="searchBarInput" type="text" title="Search Google" placeholder="Search">
                        <button id="searchBarButton" onclick="search();">&#x1f50d; Search</button>
                    </div>
                </div>

                <div id="tv.app" class="hidden">
                    <audio id="tvPowerSound" src="audio/turnontv.mp3"></audio>
                    <iframe id="televisionImage" src="https://youtube.com/embed/jfKfPfyJRdk"></iframe>
                </div>

                <div id="timer.app" class="hidden">
                    <div id="currentTimer" class="leftGrid grid">
                        <audio id="timerAlarm" src="audio/alarm.mp3" preload></audio>
                        <h2 id="currentTimerName">Select a Timer</h2>
                        <div id='currentTimerInformationContainer'>                            
                        </div>

                    </div>
                    
                    <div id="timerListSet" class="rightGrid grid">
                        <h2>Timers </h2>
                        <div id='timerListCollectionContainer' class='tableListContainer'>
                            <table id="timerListCollection">
                    
                            </table>
                        </div>
                    </div>
                    
                    <br class="clearBreak hidden">
                </div>

            </div>

        
            <div id="controlBar">
                <button id="backButtonControl">Back</button>
                <button id="homeButtonControl" onclick="switchApps('home');">Home</button>
                <button id="openFridgeToggleButton" onclick="toggleFridgeOpen();">Open Fridge</button>
                <span id="temperatureControls">
                    <span>Fridge Temperature: </span>
                    <button class="circularControlButton" onclick="adjustFridgeTemperature(-1)"> &lt; </button>
                    <span id="fridgeTemperatureDisplay" onclick="toggleTemperatureUnits();">
                        <span id="fridgeTemperature">33</span>&#x00b0;<span class="temperatureUnits">F</span>
                    </span>
                    <button class="circularControlButton" onclick="adjustFridgeTemperature(1)"> > </button>
                </span>
        
                <button style="float: right;" onclick="toggleDisplayPower()">Display Power</button>
                <br style="clear: right;">
            </div>
        
        </div>

    </main> 
    
    <footer id="footerBar">
        <div id="footerText">
            &copy; Brendan Gibbons - 3/10/23
        </div>
        <div id="credits">
            <!-- On click, information about sources for certain information is provided -->
            <button onclick="showCreditsAlert();">Credits</button>
        </div>
    </footer>


    <script>
        // Global variables for the state of the three elements
        var fridgeIsOpen = false;
        var displayIsOn = true;

        var useCelsiusTemperature = false; 
        var use12HourTime = true;
        var showInformationBar = true;
        

        // Task List Defaults

        var savedLists = [];


        // https://stackoverflow.com/questions/19529403/how-can-i-loop-through-a-javascript-object-array
        savedLists[0] = {
                            name: "Shopping List",
                            list: [   
                                    {name: "Milk", isChecked: true}, 
                                    {name: "Stewart's Ice Cream", isChecked: true},
                                    {name: "Breakfast Sausage", isChecked: false},
                                    {name: "Nougat", isChecked: true},
                                    {name: "Oatmeal Cookie Mix", isChecked: true}
                                  ],
                            isFavorite: true
                        };
        savedLists[1] = {
                            name: "Video Games for the Kids",
                            list: [
                                    {name: "Pokemon", isChecked: true},
                                    {name: "Roblox Premium", isChecked: false}
                                  ],
                            isFavorite: false
                        };

        
        // Timer Defaults

        savedTimers = [];

        savedTimers[0] = {
                            name: "10-Minute Timer",
                            minutes: 10,
                            seconds: 00,
                            timeRemaining: 600                 
        };

        savedTimers[1] = {
                name: "30-Second Final Jepoardy",
                minutes: 0,
                seconds: 30,
                timeRemaining: 30 
        };

        savedTimers[2] = {
                name: "1-Minute Timer",
                minutes: 1,
                seconds: 0,
                timeRemaining: 60 
        };

        


        /**
         * Sets the clock to tick every second and the temperature to update every
         * two minutes.
         *  
         */
        function setTimers() {
            setClock();
            nwsApi();
            
            // Timer for clock, which updates every second
            setInterval(() => setClock(), 1000);
            
            // Timer for temperature API call, which updates every 2 minutes
            setInterval(() => nwsApi(), 120000);

            // Timer for checking the Play/Pause Status of Spotify
            setInterval(() => spotifyCheckPlayPauseState(), 10)
        }

        /** 
         * Sets the temperature displayed based on the KPOU observation center, 
         * operated by the National Weather Service. Information is obtained using
         * a free-to-use API provided by the National Weather Service.
         * 
         * https://www.weather.gov/documentation/services-web-api
         * 
         * This function is done asynchronously, meaning it's done out of the order specified.
         * API calls can take some amount of time so we use them asynchronously
         *
         * https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON
         * https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Introducing
         * 
         */
         async function nwsApi() {
            const apiURL = "https://api.weather.gov/stations/kpou/observations/latest/";
            // URL to get weather data from Dutchess County Airport Weather Station
            
            console.log("Attempting to call api.weather.gov API...");
            var tempBoxText = document.getElementById("temperatureBoxText");
            var weatherConditions = document.getElementById("weatherConditions");
            var weatherConditionsTextBox = document.getElementById('weatherConditionsText');

            try {
                const apiRequest = new Request(apiURL);
                // Request does a new HTTP request
            
                const apiResponse = await fetch(apiRequest);
                // Fetch takes the request and lets us get resources from it (in this case, a JSON file)

                const weather = await apiResponse.json();
                // Stores the response as an object

                var weatherConditionsIcon = weather.properties.icon;
                var weatherConditionsText = weather.properties.textDescription;
                var outsideTemperature = weather.properties.temperature.value;


                if (outsideTemperature == undefined) {
                    // Output an error
                    console.error("Error: Could not call api.weather.gov API.");
                    tempBoxText.innerHTML = "<em class='tempError'>No Weather Data</em>";
                    weatherConditions.setAttribute("src", "");
                    weatherConditionsTextBox.innerText = "";
                    weatherConditions.setAttribute("title", "");
                }
                else if (!useCelsiusTemperature) {

                    // Outputs the weather conditions
                    weatherConditions.setAttribute("src", weatherConditionsIcon);
                    weatherConditionsTextBox.innerText = weatherConditionsText;
                    weatherConditions.setAttribute("title", weatherConditionsText);

                    // Convert the temperature to fahrenheit
                    tempInFahrenheit = tempToFahrenheit(outsideTemperature);
                    
                    // Output the temperature to the site and logs
                    tempBoxText.innerText = tempInFahrenheit;
                    console.log("api.weather.gov: " + tempInFahrenheit + "* F; Conditions: " + weatherConditionsText);
                }
                else {
                    // Outputs the weather conditions
                    weatherConditions.setAttribute("src", weatherConditionsIcon);
                    weatherConditionsTextBox.innerText = weatherConditionsText;
                    weatherConditions.setAttribute("title", weatherConditionsText);

                    tempBoxText.innerText = Math.round(outsideTemperature);
                    console.log("api.weather.gov: " + Math.round(outsideTemperature) + "* C" + weatherConditionsText);
                }
            }
            catch {
                console.error("Error: Could not call api.weather.gov API.");
                // Displays an error in standard error output.

                tempBoxText.innerHTML = "<em class='tempError'>No Temperature Data</em>";
                tempBoxText.style.display = "inline";
            }

        }

        function tempToFahrenheit(tempInCelsius) {
            
            return Math.round(tempInCelsius * (9 / 5) + 32);
                // Convert temperature from Celsius to Fahrenheit
        }

        function tempToCelsius(tempInFahrenheit) {
            return Math.round((5/9)*(tempInFahrenheit - 32));
            // Convert temperature from Fahrenheit to Celsius
        }

        /**
         *
         * Sets the time displayed on the clock
         *  
         */
        function setClock() {
            var datetime = new Date(); // Use to get the time.

            let hours = datetime.getHours().toString();
            let isAfternoon = (hours >= 12 ? true : false); // After 12:00:00, it's afternoon.
            let minutes = datetime.getMinutes().toString();
            let seconds = datetime.getSeconds().toString();

            if (use12HourTime) {
                // If it's the hour of 12 or 0, change it to a 12
                if (hours % 12 == 0) {
                    hours = 12;
                }
                else {
                    // Otherwise change it to the 12-hour fomat of the time
                    hours = hours % 12;
                }
            }

            // Set time in 12-hour format
            let clock = hours + ":" + minutes.padStart(2, "0") + ":" + seconds.padStart(2, "0");

            if (isAfternoon) {
                // Append pm to the time
                clock = clock + " pm";
            }
            else {
                // Append am to the time
                clock = clock + " am";
            }

            
            let timeText = document.getElementById("timeText");

            // Display the time
            timeText.innerText = clock;
        }

        /**
         * Sets the fridge to a random temperature upon loading the application.
         */ 
        function randomizeFridgeTemperature() {
            let fridgeTemp = document.getElementById("fridgeTemperature");
            fridgeTemp.innerText = Math.round(Math.random() * 15 + 31);
        }

        /**
         * Changes system time representation between 12-hour time and 24-hour (military)
         * time, then sets the clock to that representation
         */ 
        function toggle12HourTime () {

            if (use12HourTime) {
                use12HourTime = false;
            }
            else {
                use12HourTime = true;
            }

            setClock();
        }

        /**
         * Hides all elements from an active application and displays a picture of a
         * fridge to represent the fridge being open, or undoes the action to close it 
         * 
         */
        function toggleFridgeOpen() {
            var button = document.getElementById("openFridgeToggleButton");

            if (!fridgeIsOpen) {

                // Hide the information, home, and back buttons, as well as the currently 
                // active app.
                let informationBar = document.getElementById('informationBar');
                informationBar.classList.add('hidden');

                let homeButton = document.getElementById('homeButtonControl');
                homeButton.classList.add('hidden');

                let backButton = document.getElementById('backButtonControl');
                backButton.classList.add('hidden');

                let suspendedApps = document.getElementsByClassName('activeApp');

                let i = 0;
                while (i < suspendedApps.length) {
                    suspendedApps[i].classList.add('hidden');
                    i++;
                }

                let screen = document.getElementById('screen');
                screen.style.backgroundImage = 'url("img/fridgeOpen.jpeg")';
                // https://stackoverflow.com/questions/24208607/how-do-i-use-a-local-file-as-a-background-image-with-css


                fridgeIsOpen = true;

                console.log("Toggled Fridge to Open State");
                button.innerText = "Close Fridge";
            }
            else {

                // If the display was on, unhide all suspended apps, and hidden 
                // interface elements.
                if (displayIsOn) {
                    let informationBar = document.getElementById('informationBar');
                    informationBar.classList.remove('hidden');

                    let homeButton = document.getElementById('homeButtonControl');
                    homeButton.classList.remove('hidden');

                    let backButton = document.getElementById('backButtonControl');
                    backButton.classList.remove('hidden');

                    let suspendedApps = document.getElementsByClassName('activeApp');

                    let i = 0;
                    while (i < suspendedApps.length) {
                        suspendedApps[i].classList.remove('hidden');
                        i++;
                    }
                }

                let screen = document.getElementById('screen');
                screen.style.backgroundImage = 'none';

                fridgeIsOpen = false;

                console.log("Toggled Fridge to Closed State");
                button.innerText = "Open Fridge";
            }

        }   

        /**
         * Redirects the user to the Google Search page supplied in the search box. 
         * 
         */
        function search() {
            var searchBar = document.getElementById("searchBarInput");
            searchQuery = searchBar.value.trim(); // Get the entered search query

            // The search only executes if there is text put into the query.
            if (searchQuery != "") {
                console.log("Searching on Google for " + searchQuery);
                
                // URL Encoding function found at https://stackoverflow.com/questions/332872/encode-url-in-javascript
                window.location.href = "https://www.google.com/search?q=" + encodeURIComponent(searchQuery);
            }
        }

        /**
         * Displays information about the main resources used in the creation of the
         * application.
         *  
         */
        function showCreditsAlert() {

            const credits = ["Here is a list of links to some resources I used for reference:\n\n" 
                                + "API Calls: https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON \n\n"
                                + "URL Encoding Function: https://stackoverflow.com/questions/332872/encode-url-in-javascript \n\n"
                                + "National Weather Service API: https://api.weather.gov/stations/kpou/observations/latest/ \n"
                                + "https://www.weather.gov/documentation/services-web-api \n\n"
                                + "Guidance on height and width CSS: https://stackoverflow.com/questions/36253760/how-to-limit-max-width-and-height-to-screen-size-in-css \n\n"
                                + "Radial Gradients: https://developer.mozilla.org/en-US/docs/Web/CSS/gradient/radial-gradient \n\n"
                                + "Handling iframe clipping: https://www.w3docs.com/snippets/css/how-to-scale-the-content-of-iframe-element.html \n\n"
                                + "LoFi Girl Stream (Video Shown on TV): https://youtu.be/jfKfPfyJRdk \n\n",
                             "Revolve - cinematrik (song), used under Creative Commons Noncommercial Sampling Plus: https://ccmixter.org/files/hisboyelroy/430 \n"
                                + "To learn more about CC Noncommercial Sampling Plus, read here: https://creativecommons.org/licenses/nc-sampling+/1.0/ \n\n"
                                + "CSS URL Function: https://stackoverflow.com/questions/24208607/how-do-i-use-a-local-file-as-a-background-image-with-css \n\n"
                                + "HTMLInputElement API: https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement \n\n"
                                + "Audio  Controls and API: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio \n\n"
                                + "Array Find Function: https://www.geeksforgeeks.org/javascript-array-find-method/ \n\n"
                                + "ClearInterval: https://www.w3schools.com/jsref/met_win_setinterval.asp\n\n"];


            for (msg of credits) {
                alert(msg);
            }

        }

        /**
         * Sizes the fridge display and the spacing of its div so that it retains 
         * a 2 by 1 ratio while still not being hidden by the page footer.
         */ 
        function scaleDisplay() {
            let displayUnit = document.getElementById("fridgeDisplayUnit");
            let displayWidth = displayUnit.scrollWidth;

            // Maintain 2 by 1 aspect ratio
            displayUnit.style.height = displayWidth / 2 + "px";

            var footer = document.getElementById("footerBar");

            displayUnit.style.marginBottom = "calc(" + footer.scrollHeight.toString() + "px + 4%)";
            console.log("Contents box's bottom margin was scaled successfully");

        }

        /**
         * Adjusts the displayed temperature of the fridge based on the argument
         * passed, with positive numbers increasing temperature and negative 
         * numbers decreasing it. 
         */ 
        function adjustFridgeTemperature(adjustmentMagnitude) {
            let fridgeTemp = document.getElementById("fridgeTemperature");

            let fridgeTempAsNumber = parseInt(fridgeTemp.innerText);
            let adjustmentMagnitudeAsNumber = parseInt(adjustmentMagnitude);
            
            fridgeTemp.innerText = fridgeTempAsNumber + adjustmentMagnitudeAsNumber;

            console.log("Adjusting the fridge's temperature by " + adjustmentMagnitudeAsNumber);

            
        }

        /**
         * Changes the temperature units from celsius to fahreheit and vice versa
         */ 
        function toggleTemperatureUnits() {
            let unitRepresentation = document.getElementsByClassName("temperatureUnits");

            let fridgeTemp = document.getElementById("fridgeTemperature");

            if (useCelsiusTemperature) {
                // Convert the current fridge temperature to Fahrenheit
                fridgeTemp.innerText = tempToFahrenheit(fridgeTemp.innerText);
                
                useCelsiusTemperature = false;
                // Update outside temperature
                nwsApi();
                
                // Change all temperatures to use Fahrenheit units
                for (i in unitRepresentation) {
                    unitRepresentation[i].innerText = "F";
                }
            }
            else {
                // Convert the fridge temperature to Celsius
                fridgeTemp.innerText = tempToCelsius(fridgeTemp.innerText);

                useCelsiusTemperature = true;
                // Update outside temperature.
                nwsApi();

                // Change all temperatures to use Celsius units
                for (i in unitRepresentation) {
                    unitRepresentation[i].innerText = "C";
                }
            }
 
        }

        /**
         * "Switches" the app in use by changing the visible divs to the ones 
         * associated with an application
         */ 
        function switchApps(newApp) {
            let activeApps = document.getElementsByClassName('activeApp');
            let appToOpen = document.getElementById(newApp)

            // Hides all currently active apps using the CSS class 'hidden'
            // Also removes the 'activeApp' class
            while(activeApps.length != 0) {
                activeApps[0].classList.add('hidden')
                activeApps[0].classList.remove('activeApp')
            } 

            // Apply the 'activeApp' class to the new app
            // Also remove the 'hidden' class
            appToOpen.classList.add('activeApp')
            appToOpen.classList.remove('hidden')
            
        }

        /**
         * Turns on and off the fridge display by hiding and showing the visible
         *  elements of the active application
         */ 
        function toggleDisplayPower() {    

            if (fridgeIsOpen) {
                // If the fridge is open, the display will already be "off", in a way
                // So there is no need to toggle the fridge display power
                return;
            }

            if (displayIsOn) {

                let informationBar = document.getElementById('informationBar');
                informationBar.classList.add('hidden');

                let homeButton = document.getElementById('homeButtonControl');
                homeButton.classList.add('hidden');

                let backButton = document.getElementById('backButtonControl');
                backButton.classList.add('hidden');

                let suspendedApps = document.getElementsByClassName('activeApp');

                let i = 0;
                while (i < suspendedApps.length) {
                    suspendedApps[i].classList.add('hidden');
                    i++;
                }

                let screen = document.getElementById('screen');
                screen.style.backgroundColor = '#000000';

                displayIsOn = false;
            }
            else {

                let informationBar = document.getElementById('informationBar');
                informationBar.classList.remove('hidden');

                let homeButton = document.getElementById('homeButtonControl');
                homeButton.classList.remove('hidden');

                let backButton = document.getElementById('backButtonControl');
                backButton.classList.remove('hidden');

                let suspendedApps = document.getElementsByClassName('activeApp');

                let i = 0;
                while (i < suspendedApps.length) {
                    suspendedApps[i].classList.remove('hidden');
                    i++;
                }

                let screen = document.getElementById('screen');
                screen.style.backgroundColor = '#1e1e1e';

                displayIsOn = true;
            }
        }

        function spotifyPlayPause() {
            let playPauseButton = document.getElementById('spotifyPlayButton');
            let spotifyMusicSource = document.getElementById('spotifyMusicSource');

            let logString = "spotify.app: Music ";

            if (!spotifyMusicSource.paused) {
                spotifyMusicSource.pause();

                logString += "was paused";
            }
            else {
                spotifyMusicSource.play();

                logString += "started playing";
            }

            // Print console log message
            console.log(logString);

        }

        /**
         * Changes the play-pause button according to the state of the music source's playing
         * state
         * 
         */ 
        function spotifyCheckPlayPauseState() {
            let spotifyMusicSource = document.getElementById('spotifyMusicSource');
            let playPauseButton = document.getElementById('spotifyPlayButton');

            if (spotifyMusicSource.paused || spotifyMusicSource.ended) {
                playPauseButton.setAttribute('src', 'img/mediaControl/control_Play.png');
            }
            else {
                playPauseButton.setAttribute('src', 'img/mediaControl/control_Pause.png');
            }
        }

        /**
         * Triggers a sound effect for the TV being opened and turns off sound from 
         * Spotify
         */ 
        function tvLoadPrep () {
            let spotifyMusicSource = document.getElementById('spotifyMusicSource');

            document.getElementById('tvPowerSound').play();

            if (!spotifyMusicSource.paused && !spotifyMusicSource.ended) {
                spotifyMusicSource.pause();
                console.log("tv.app: Music from other applications was paused.");
            }
        }

        /**
         * Loads the list of tasks into the Tasks app
         * 
         */ 
        function loadTaskLists() {
            let taskListCollection = document.getElementById('taskListCollection');

            let htmlString = "";

            // https://stackoverflow.com/questions/7480020/for-in-loop-with-string-array-outputs-indices
            for (list of savedLists) {
                console.log("Loading " + list.name + " to task list");
                // Create a button for each
                htmlString += "<tr> <td class='selectionListBlock' onclick='viewTasks(\"" + list.name + "\")'> "
                    + "<span class='taskListName'>" + list.name + "</span>"
                    + "</td> </tr>";
            }

            taskListCollection.innerHTML = htmlString;
        }

        /**
         * Displays all items associated with a Task on the left side of the 
         * Tasks app
         * 
         */ 
        function viewTasks(listName) {
            let taskChecklist = document.getElementById('currentTaskListTable');
            let currentTaskListTableContainer = document.getElementById('currentTaskListTableContainer');
            let currentTaskListName = document.getElementById('currentTaskListName');
            let taskAddItemButton = document.getElementById('taskAddItemButton');
            
            console.log("Viewing checklist items for " + listName);

            var list = savedLists.find(list => list.name === listName);

            console.log("Item " + list.name);

            currentTaskListName.innerText = listName;
            let htmlString = "";

            for (item of list.list) {
                console.log("Loading " + item.name + " to task checklist");
                
                // Replace quotes in a field with an HTML representation
                let itemNameInHTML = "" + item.name;
                itemNameInHTML = itemNameInHTML.replace("'", "&apos;").replace('"', "&quot;");
                
                // Create a block with the task information. 
                // Data input to a displayed item currently does not update
                htmlString += "<tr> <td class='selectionListBlock'> "
                    + "<input class='taskChecklistCheck' type='checkbox' value='checked'";

                if (item.isChecked) {
                    htmlString += "checked";
                }

                htmlString += "> <input class='taskChecklistItem' type='text' value='" + itemNameInHTML + "'>"
                    + "</td> </tr>";
            }


            taskChecklist.innerHTML = htmlString;

            currentTaskListTableContainer.style.display = 'block';
            taskAddItemButton.style.display = 'block';
        }

        /**
         * Adds a saveable item to a task list
         * 
         */ 
        function addTaskItem(taskListName) {
            let taskChecklist = document.getElementById('currentTaskListTable');

            // Get the task list this item belongs to
            for (i of savedLists) {
                if (i.name == taskListName) {
                    list = i;
                    break;
                }
            }

            console.log("List " + list.name);

            let htmlString = "";


            console.log("Adding a new task " + list.name + " to task checklist");
            
            // Replace quotes with HTML special characters
            let listNameInHTML = "" + list.name;
            listNameInHTML.replace("'", "&apos;").replace('"', "&quot;");
            
            // Display necessary controls and toggles
            htmlString += "<tr> <td class='selectionListBlock'> "
                + "<input class='taskChecklistCheck' type='checkbox' disabled>"
                + "<input class='taskChecklistItem' type='text' value='New Item'>"
                + "<button onclick='saveTaskItem(\"" + listNameInHTML + "\", this);'>Save</button>"
                + "</td> </tr>";

                
            // https://stackoverflow.com/questions/1553661/how-to-get-the-onclick-calling-object
            taskChecklist.innerHTML += htmlString;
        }

        /**
         * Saves a user-created task list entry. The checklist state defaults to false.
         */ 
        function saveTaskItem(listName, object) {
            let taskChecklist = document.getElementById(listName);
            // Get the input box which holds the name.
            let nameElement = object.parentElement.getElementsByClassName('taskChecklistItem');
            nameElement = nameElement[0].value;
            

            // https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/checkbox
            // Get the selected list
            for (i in savedLists) {
                if (savedLists[i].name == listName) {
                    list = savedLists[i];
                    break;
                }
            }

            console.log("List " + list.name);

            // Check if the item is already on the list
            for (item of list.list) {
                if (item.name == nameElement) {
                    // Abort saving if it is
                    alert(nameElement + " is already on " + listName + ".");
                    return;
                } 
            }

            // Add the item to the task list
            list.list.push({name: nameElement, isChecked: false});

            // Display the updated task list
            viewTasks(document.getElementById('currentTaskListName').innerText);
        }

        /**
         * Display the list of timers in the Timer app.
         * 
         */ 
        function loadTimerLists() {
            let timerListCollection = document.getElementById('timerListCollection');

            let htmlString = "";

            // Get each timer from the list of saved timers
            for (timer of savedTimers) {
                console.log("Loading " + timer.name + " to timer list");

                // Replace quotes with their HTML special characters
                let timerNameInHTML = "" + timer.name;
                timerNameInHTML = timerNameInHTML.replace("'", "&apos;").replace('"', "&quot;");

                htmlString += "<tr> <td class='selectionListBlock' onclick='viewTimer(\"" + timerNameInHTML + "\")'> "
                    + "<div class='timerListName'>" + timerNameInHTML + "</div>"
                    + "</td> </tr>";
            }

            timerListCollection.innerHTML = htmlString;
        }

        /**
         * Displays the timer selected by the user and its controls.
         */ 
        function viewTimer(timerName) {
            let timerData = document.getElementById('currentTimer');
            let currentTimerName = document.getElementById('currentTimerName');
            let currentTimerInformationContainer = document.getElementById('currentTimerInformationContainer');
            let timerStartButton = document.getElementById('timerStartButton');

            console.log("Getting timer data for " + timerName);

            // Returns the requested timer's object
            var timer = savedTimers.find(timer => timer.name === timerName);

            console.log("Timer " + timer.name);

            // Set the name of the timer on the left side
            currentTimerName.innerText = timerName;

            let htmlString = "";

            // Set up the clock layout
            htmlString += "<span class='timerClock'> : </span>";
            htmlString += "<button class='timerStartButton' onclick='startTimer(\"" + timer.name + "\", this);' "
                            + "title='Start the Timer'>Start Timer</button>";
            
            currentTimerInformationContainer.innerHTML = htmlString;
            // Set the time remaining using the HTML elements we just created.
            timerDisplay = (currentTimerInformationContainer.getElementsByClassName('timerClock'))[0]

            setTimerDisplay(timer, timerDisplay);

        }

        /**
         * Starts a setInterval for the timer activated by the user, and sets the 
         * timer display based on the progress made on the timer.
         */ 
        function startTimer(timerName, buttonObject) {
            let timer = savedTimers.find(timer => timer.name === timerName);

            let timerDisplay = (buttonObject.parentElement.getElementsByClassName('timerClock'))[0];
            
            buttonObject.innerText = "Reset Timer";

            timer.timeRemaining = (timer.minutes * 60) + timer.seconds;

            // For ClearInterval: https://www.w3schools.com/jsref/met_win_setinterval.asp
            const timerId = setInterval( () =>  {
                                    // Subtract 1 second and update the timer
                                    timer.timeRemaining -= 1;
                                    setTimerDisplay(timer, timerDisplay);

                                    // Timer ending procedure.
                                    if (timer.timeRemaining == 0) {

                                        let alarm = document.getElementById('timerAlarm');
                                        
                                        // Plays an audio clip to indicate the end of the timer
                                        alarm.play();
                                        console.log("Timer: " + timer.name + " finished");
                                        
                                        // Changes the time remaining back to the original time
                                        resetTimer(timer, timerDisplay, timerId);
                                    }


                                }, 1000);
            
            // The "Start Timer" button now resets the timer (somewhat buggy at the moment).
            buttonObject.setAttribute("onclick", "resetTimer(timer, timerDisplay, " + timerId + ")");                  

            console.log("Timer: " + timer.name + " started");

        }

        /**
         * Sets the currently displayed timer based on the time remaining on that timer
         */ 
        function setTimerDisplay(timer, timerDisplay) {
            let newSeconds = timer.timeRemaining % 60;
            let newMinutes = Math.floor(timer.timeRemaining / 60);

            timerDisplay.innerText = newMinutes.toString() + " : " + newSeconds.toString().padStart(2, '0');
        }

        /**
         * Resets the displayed time.
         */ 
        function resetTimer(timer, timerDisplay, timerId) {
            clearInterval(timerId);

            timer.timeRemaining = (timer.minutes * 60) + timer.seconds;
            setTimerDisplay(timer, timerDisplay);

            viewTimer(timer.name);
        }



    </script>

</body>



</html>